name: Execute Jupyter Notebooks

on:
  push:
    paths: ['Code/**.ipynb', '**/run_notebooks.yml']
  pull_request:
    paths: ['Code/**.ipynb', '**/run_notebooks.yml']
  workflow_dispatch:
  schedule:
    - cron: '0 6 1 * *'  # Runs at 06:00 UTC 1st day of the month

jobs:
  run-notebooks:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.x'
    - name: Install Dependencies
      run: |
        pip install nbconvert ipykernel
        pip install numpy matplotlib biogeme pandas seaborn scikit-learn
    - name: Find and Execute Jupyter Notebooks
      run: |
        error=0
        find Code -name "*.ipynb" -print0 | while IFS= read -r -d $'\0' notebook; do
          # Extract the directory path of the notebook
          notebook_dir=$(dirname "$notebook")
          # Execute the notebook within its directory
          (cd "$notebook_dir" && jupyter nbconvert --to notebook --execute "$(basename "$notebook")" --output "$(basename "$notebook")") || error=1
          if [ $? -eq 0 ]; then
            echo -e "\u2705 Passed: $notebook"
          else
            echo -e "\u274C Failed: $notebook"
          fi
        done
        if [ "$error" -ne 0 ]; then
          exit 1
        fi
